package immutxtdb

import (
	_ "encoding/binary"
	_ "fmt"
	"testing"

	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"
)

func TestEncoder_EncodeDecode(t *testing.T) {
	expectedSeq := 42
	expectedData := []byte("baz")
	expectedState := document
	b, err := encodeIndexLine0(expectedSeq, expectedData, expectedState)
	assert.NoError(t, err)
	require.NotNil(t, b)
	assert.True(t, len(b) > 6)

	n, seq, data, state := decodeFirstIndexLine0[[]byte](b)
	assert.Equal(t, len(b), n)
	assert.Equal(t, expectedSeq, seq)
	require.NotNil(t, data)
	assert.Equal(t, expectedData, *data)
	assert.Equal(t, expectedState, state)

}
